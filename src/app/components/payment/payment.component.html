<section class="blue-back-pay">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <h1>World best Tailored trips</h1>
      </div>
    </div>
  </div>
</section>

<section>
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
          <div class="contect-us">
            <h2><img src="assets/images/icon-contact.png" /> Tailored trips</h2>

            <div class="detail-contect">
              <div class="nameplace-1">
                <label>Name</label>
                <div class="mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <img src="assets/images/payment-icon-1.png" />
                    </div>
                    <input
                      class="form-control"
                      formControlName="name"
                      placeholder="Enter Your Name"
                      type="text"
                    />
                  </div>
                  <div
                    *ngIf="
                      paymentForm.get('name')?.invalid &&
                      paymentForm.get('name')?.touched
                    "
                    class="text-danger"
                  >
                    <small *ngIf="paymentForm.get('name')?.errors?.['required']"
                      >Name is required.</small
                    >
                  </div>
                </div>
              </div>
              <div class="nameplace-1">
                <label>Phone Number</label>
                <div class="mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <img src="assets/images/payment-icon-3.png" />
                    </div>
                    <input
                      class="form-control"
                      formControlName="phoneNumber"
                      placeholder="Enter Your Phone Number"
                      type="tel"
                      pattern="[0-9]{10,15}"
                    />
                  </div>
                  <div
                    *ngIf="
                      paymentForm.get('phoneNumber')?.invalid &&
                      paymentForm.get('phoneNumber')?.touched
                    "
                    class="text-danger"
                  >
                    <small
                      *ngIf="paymentForm.get('phoneNumber')?.errors?.['required']"
                      >Phone number is required.</small
                    >
                    <small
                      *ngIf="paymentForm.get('phoneNumber')?.errors?.['pattern']"
                      >Invalid phone number (10-15 digits).</small
                    >
                  </div>
                </div>
              </div>
            </div>
            <div class="detail-contect">
              <div class="nameplace-1">
                <label>Email</label>
                <div class="mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <img src="assets/images/payment-icon-2.png" />
                    </div>
                    <input
                      class="form-control"
                      formControlName="email"
                      placeholder="Enter Your Email Address"
                      type="email"
                    />
                  </div>
                  <div
                    *ngIf="
                      paymentForm.get('email')?.invalid &&
                      paymentForm.get('email')?.touched
                    "
                    class="text-danger"
                  >
                    <small
                      *ngIf="paymentForm.get('email')?.errors?.['required']"
                      >Email is required.</small
                    >
                    <small *ngIf="paymentForm.get('email')?.errors?.['email']"
                      >Invalid email address.</small
                    >
                  </div>
                </div>
              </div>

              <div class="nameplace-1">
                <label>Nationality</label>
                <div class="mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      <img src="assets/images/payment-icon-4.png" />
                    </div>
                    <select class="form-control" formControlName="nationality" id="nationality" required>
                      <option value="">Select Your Nationality</option>
                      <option value="Indian">Indian</option>
                      <option value="American">American</option>
                      <option value="British">British</option>
                      <option value="Canadian">Canadian</option>
                      <option value="Australian">Australian</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div *ngIf="paymentForm.get('nationality')?.invalid && paymentForm.get('nationality')?.touched" class="text-danger">
                    <small *ngIf="paymentForm.get('nationality')?.errors?.['required']">Nationality is required.</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-contect d-flex flex-column flex-lg-row">
              <!-- Left: Check In and Check Out (full width on small/medium, half on lg+) -->
              <div class="nameplace-1 flex-fill pe-lg-2">
                <label>Check In and Check Out</label>
                <div class="mb-2">
                  <div class="checkin d-flex flex-column flex-md-row gap-2">
                    <!-- d-flex + flex-column flex-md-row + gap-2 for stacking dates on small, side-by-side on md+ -->
                    <div class="flt-nav flex-fill">
                      <mat-form-field class="w-100">
                        <mat-label>Check In</mat-label>
                        <input
                          matInput
                          [matDatepicker]="pickerIn"
                          formControlName="checkIn"
                          [min]="tourData?.departure_date || today"
                        />
                        <mat-datepicker-toggle
                          matSuffix
                          [for]="pickerIn"
                        ></mat-datepicker-toggle>
                        <mat-datepicker #pickerIn></mat-datepicker>
                        <mat-icon
                          matSuffix
                          (click)="clearDate('checkIn')"
                          *ngIf="paymentForm.get('checkIn')?.value"
                          class="clear-icon"
                          >clear</mat-icon
                        >
                      </mat-form-field>
                      <div
                        *ngIf="
                          paymentForm.get('checkIn')?.invalid &&
                          paymentForm.get('checkIn')?.touched
                        "
                        class="text-danger"
                      >
                        <small
                          *ngIf="paymentForm.get('checkIn')?.errors?.['required']"
                          >Check In date is required.</small
                        >
                        <small
                          *ngIf="paymentForm.get('checkIn')?.errors?.['matDatepickerMin']"
                          >Check In date cannot be before
                          {{ tourData?.departure_date || today }}.</small
                        >
                      </div>
                    </div>
                    <div class="rgt-nav flex-fill">
                      <mat-form-field class="w-100">
                        <mat-label>Check Out</mat-label>
                        <input
                          matInput
                          [matDatepicker]="pickerOut"
                          formControlName="checkOut"
                          [min]="paymentForm.get('checkIn')?.value"
                        />
                        <mat-datepicker-toggle
                          matSuffix
                          [for]="pickerOut"
                        ></mat-datepicker-toggle>
                        <mat-datepicker #pickerOut></mat-datepicker>
                        <mat-icon
                          matSuffix
                          (click)="clearDate('checkOut')"
                          *ngIf="paymentForm.get('checkOut')?.value"
                          class="clear-icon"
                          >clear</mat-icon
                        >
                      </mat-form-field>
                      <div
                        *ngIf="
                          paymentForm.get('checkOut')?.invalid &&
                          paymentForm.get('checkOut')?.touched
                        "
                        class="text-danger"
                      >
                        <small
                          *ngIf="paymentForm.get('checkOut')?.errors?.['required']"
                          >Check Out date is required.</small
                        >
                        <small
                          *ngIf="paymentForm.get('checkOut')?.errors?.['matDatepickerMin']"
                          >Check Out date must be after Check In.</small
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right: Travelers (full width on small/medium, half on lg+) -->
              <div class="nameplace-1 flex-fill ps-lg-2">
                <label>Travelers</label>
                <div class="mb-2">
                  <!-- Material menu (dropdown) with quantity selectors -->


                  <mat-menu #quantityMenu="matMenu" [overlapTrigger]="false">
  <!-- Adult row -->
  <div class="d-flex justify-content-between align-items-center px-3 py-2 w-100">
    <label class="mb-0 small">Adult</label>
    <div class="d-flex align-items-center">
      <button
        mat-icon-button
        type="button"
        class="me-1"
        (click)="updateTravelers('adult', -1); $event.stopPropagation()"
        [disabled]="travelers.adult <= 0"
      >
        <mat-icon>remove</mat-icon>
      </button>
      <span class="me-2 fw-bold px-2">{{ travelers.adult }}</span>
      <button
        mat-icon-button
        type="button"
        (click)="updateTravelers('adult', 1); $event.stopPropagation()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>

  <!-- Child row -->
  <div class="d-flex justify-content-between align-items-center px-3 py-2 w-100">
    <label class="mb-0 small">Child</label>
    <div class="d-flex align-items-center">
      <button
        mat-icon-button
        type="button"
        class="me-1"
        (click)="updateTravelers('child', -1); $event.stopPropagation()"
        [disabled]="travelers.child <= 0"
      >
        <mat-icon>remove</mat-icon>
      </button>
      <span class="me-2 fw-bold px-2">{{ travelers.child }}</span>
      <button
        mat-icon-button
        type="button"
        (click)="updateTravelers('child', 1); $event.stopPropagation()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>

  <!-- Infant row -->
  <div class="d-flex justify-content-between align-items-center px-3 py-2 w-100">
    <label class="mb-0 small">Infant</label>
    <div class="d-flex align-items-center">
      <button
        mat-icon-button
        type="button"
        class="me-1"
        (click)="updateTravelers('infant', -1); $event.stopPropagation()"
        [disabled]="travelers.infant <= 0"
      >
        <mat-icon>remove</mat-icon>
      </button>
      <span class="me-2 fw-bold px-2">{{ travelers.infant }}</span>
      <button
        mat-icon-button
        type="button"
        (click)="updateTravelers('infant', 1); $event.stopPropagation()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>
  </div>
</mat-menu>


                  <!-- Material form field with readonly input as menu trigger -->
                  <mat-form-field class="w-100" appearance="outline">
                    <mat-label>Click to adjust travelers</mat-label>
                    <!-- Keep Bootstrap class if needed for styling -->
                    <input
                      matInput
                      [matMenuTriggerFor]="quantityMenu"
                      class="form-control"
                      formControlName="travelers"
                      readonly
                      [value]="getTravelersDisplay()"
                    />
                    <!-- Optional: Add a suffix icon to indicate it's interactive -->
                    <mat-icon matSuffix [matMenuTriggerFor]="quantityMenu" class="cursor-pointer">edit</mat-icon>
                  </mat-form-field>
                </div>

                <!-- Error display (unchanged) -->
                <div
                  *ngIf="
                    paymentForm.get('travelers')?.invalid &&
                    paymentForm.get('travelers')?.touched
                  "
                  class="text-danger"
                >
                  <small *ngIf="paymentForm.get('travelers')?.errors?.['required']">
                    Travelers count is required.
                  </small>
                </div>
              </div>
            </div>

            <!-- Next section (Hotel Rating + Direct Flight) remains unchanged -->
            <div class="detail-contect">
              <div class="nameplace-1">
                <label>Hotel Rating</label>
                <mat-form-field class="w-100">
                  <mat-label>Select Rating</mat-label>
                  <mat-select formControlName="hotelRating">
                    <mat-option value="5 Star">5 Star</mat-option>
                    <mat-option value="4 Star">4 Star</mat-option>
                    <mat-option value="3 Star">3 Star</mat-option>
                  </mat-select>
                </mat-form-field>
                <div
                  *ngIf="
                    paymentForm.get('hotelRating')?.invalid &&
                    paymentForm.get('hotelRating')?.touched
                  "
                  class="text-danger"
                >
                  <small
                    *ngIf="paymentForm.get('hotelRating')?.errors?.['required']"
                    >Hotel rating is required.</small
                  >
                </div>
              </div>
              <div class="nameplace-1">
                <div class="custom-control custom-checkbox">
                  <input
                    class="custom-control-input"
                    type="checkbox"
                    id="directFlight"
                    formControlName="directFlight"
                  />
                  <label class="custom-control-label" for="directFlight"
                    >Direct Flight</label
                  >
                </div>
              </div>
            </div>

            <div
              id="userMessage"
              class="hidden"
              role="alert"
              *ngIf="submitError"
            >
              <span id="messageText" class="text-danger">{{
                submitError
              }}</span>
            </div>
            <div class="btton-space">
              <button
                type="submit"
                id="book-now-btn"
                class="btn-new"
                [disabled]="paymentForm.invalid"
              >
                Book Now
              </button>
            </div>
          </div>
        </form>
      </div>
      <!-- Closing col-lg-8 here -->
      <div class="col-lg-4">
        <div class="my-trip">
          <div class="details">
            <div><h2>My Trip</h2></div>
            <div class="price-pay">
              <span>-{{ tourData?.discount_percentage }}%</span>
              <p>Best price Guarantee</p>
            </div>
          </div>
          <strong>{{ tourData?.title }}</strong>
          <p>{{ tourData?.duration_display }}</p>
          <strong
            >Starts in {{ tourData?.start_city | titlecase }},
            {{ tourData?.country }}</strong
          >
          <p>{{ startDateFormatted }}</p>
          <strong
            >Ends in {{ tourData?.end_city | titlecase }},
            {{ tourData?.country }}</strong
          >
          <p>{{ endDateFormatted }}</p>
          <strong>Operated in</strong>
          <p>
            English, German, Italian, Portuguese, French, Spanish, Dutch,
            Russian
          </p>
          <strong>What's included</strong>
          <p>Accommodation, Guide, Meals, Transport</p>
        </div>

        <div class="price-breakdown">
          <h2>Price Breakdown</h2>

          <span>
            Select the number of travelers and assign accommodation to display
            the price.
          </span>
        </div>
      </div>
      <!-- Closing col-lg-4 here -->
    </div>
    <!-- Closing row here -->
  </div>
  <!-- Closing container here -->
</section>

<div class="clearfix"></div>